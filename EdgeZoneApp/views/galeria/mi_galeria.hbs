<h1 class="text-center">{{title}}</h1>

<div class="galleryContainer row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 mt-3">
  {{#each miniaturas}}
    <div class="col">
      <div class="miniboxStandard card h-100 border rounded text-center">
        <!-- Nombre -->
        <div class="miniName card-header">
          <div class="miniNameNormal">{{nombre}}</div>
        </div>

        <!-- Imagen -->
        <div class="miniImage card-img-top my-2">
          <a href="{{#if imagen_url}}{{imagen_url}}{{else}}/images/placeholder.png{{/if}}" target="_blank">
            <img src="{{#if imagen_url}}{{imagen_url}}{{else}}/images/placeholder.png{{/if}}" 
                 alt="{{nombre}}" class="img-fluid rounded">
          </a>
        </div>

        <!-- Colección (opcional) -->
        {{#if coleccion}}
        <div class="miniColection card-body">
          <p class="mb-1">{{coleccion}}</p>
        </div>
        {{/if}}

        <!-- Descripción -->
        {{#if descripcion}}
        <div class="miniDescription card-body">
          <p class="mb-1">{{descripcion}}</p>
        </div>
        {{/if}}

        <!-- Fecha -->
        <div class="miniDate card-footer">
          {{formatDate fecha_subida}}
        </div>

        <!-- Acciones -->
        <div class="card-footer d-flex justify-content-around">
          <a href="/galeria/editar/{{id}}" class="btn btn-sm btn-warning">Editar</a>

          <!-- Botón que abre modal -->
          <button 
            type="button" 
            class="btn btn-sm btn-danger btn-delete-mini" 
            data-id="{{id}}"
            data-nombre="{{nombre}}"
            data-bs-toggle="modal" 
            data-bs-target="#modalBorrarMini">
            Borrar
          </button>
        </div>
      </div>
    </div>
  {{/each}}
</div>



{{!-- PAGINACIÓN --}}
<nav aria-label="Page navigation example" class="mt-4">
  <ul class="pagination justify-content-center">
    {{#if (gt currentPage 1)}}
      <li class="page-item">
        <a class="page-link" href="?page={{decrement currentPage}}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
    {{/if}}

    {{#each (range 1 totalPages)}}
      <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
        <a class="page-link" href="?page={{this}}">{{this}}</a>
      </li>
    {{/each}}

    {{#if (lt currentPage totalPages)}}
      <li class="page-item">
        <a class="page-link" href="?page={{increment currentPage}}" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    {{/if}}
  </ul>
</nav>



{{!-- MODAL PARA BORRAR --}}
<div class="modal fade" id="modalBorrarMini" tabindex="-1" aria-labelledby="modalBorrarMiniLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="modalBorrarMiniLabel">Eliminar Miniatura</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p id="textoConfirmacionMini">
          ¿Seguro que deseas eliminar esta miniatura?
        </p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

        <form id="formBorrarMini" method="post">
          <button type="submit" class="btn btn-danger">Eliminar</button>
        </form>
      </div>

    </div>
  </div>
</div>



{{!-- SCRIPT PARA CONTROLAR EL MODAL --}}
<script>
document.addEventListener("DOMContentLoaded", () => {

  const deleteButtons = document.querySelectorAll(".btn-delete-mini");
  const texto = document.getElementById("textoConfirmacionMini");
  const form = document.getElementById("formBorrarMini");

  deleteButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      
      const id = btn.getAttribute("data-id");
      const nombre = btn.getAttribute("data-nombre");

      // Cambiar texto
      texto.textContent = "¿Realmente deseas borrar la miniatura \"" + nombre + "\"?";

      // Apuntar el form a la ruta correcta
      form.action = "/galeria/borrar/" + id;
    });
  });

});
</script>
